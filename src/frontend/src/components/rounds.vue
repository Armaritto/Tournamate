<template>
  <Header></Header>
  <div class="page">
    <div style="margin-top: 30px;">
      <table style="width: 50%">
        <tr v-for="(match, index) in matches" :key="index">
          <div class="match">
            <div class="inmatch">
              <div class="teams">
                {{match.teamA}}
              </div>
            </div>
            <div>
              <div class="center dropdown">
                <div v-if="(match.scoreTeamA === -1) && (match.scoreTeamB === -1)" class="buttons dropbtn" @click="">
                  {{"set result"}}
                  <div class="dropdown-content">
                    <a @click="this.setScore('D',index); console.log('index of match = '+index)">0.5 - 0.5</a>
                    <a @click="this.setScore('P2',index); console.log('index of match = '+index)">0 - 1</a>
                    <a @click="this.setScore('P1',index); console.log('index of match = '+index)">1 - 0</a>
                  </div>
                </div>
                <div v-else class="buttons">
                  {{(match.scoreTeamA + " - " + match.scoreTeamB)}}
                </div>
              </div>
            </div>
            <div class="inmatch">
              <div class="teams">
                {{match.teamB}}
              </div>
            </div>
          </div>
        </tr>
      </table>
    </div>
    <div class="bigBUTTONCLASS">
      <div class="bigBUTTONS">
        <button class="blue-button" @click="generateNewRound() ">
          <div style="display: flex; flex-direction: column; align-items: center">
            <lord-icon
                src="https://cdn.lordicon.com/nizfqlnk.json"
                trigger="hover"
                colors="primary:#213555"
                style="width:100px;height:100px">
            </lord-icon>
            <div>
              <br>
              generate new round
            </div>
          </div>
        </button>
        <router-link to="/swissStandings">
          <button class="blue-button">
            <div style="display: flex; flex-direction: column; align-items: center">
              <lord-icon
                  src="https://cdn.lordicon.com/whrxobsb.json"
                  trigger="hover"
                  colors="primary:#213555"
                  style="width:100px;height:100px">
              </lord-icon>
              <div>
                <br>
                View Standings
              </div>
            </div>
          </button>
        </router-link>
      </div>
    </div>
  </div>
</template>

<script>
import myMixin from "@/components/myMixin";
import {defineComponent} from "vue";
import Header from "@/components/Header.vue";
export default defineComponent({
  props: ['tournamentID'],
  components: {Header},
  mixins: [myMixin],
  data(){
    return{
      roundNumber: 1,
      tournamentID: 13 ,
      matches:[
      ],
      setScore: function (status,matchNumber){
        fetch("http://localhost:8080/swiss/setMatch?" + new URLSearchParams({
          roundNumber:this.roundNumber.toString(),
          matchNumber:matchNumber,
          matchStatus:status.toString(),
          id:13
      }),{
          method: 'PUT'
        })
        switch (status){
          case "D":
            this.matches[matchNumber].scoreTeamA = 0.5;
            this.matches[matchNumber].scoreTeamB = 0.5;
            break;
          case "P1":
            this.matches[matchNumber].scoreTeamA = 1;
            this.matches[matchNumber].scoreTeamB = 0;
            break;
          case "P2":
            this.matches[matchNumber].scoreTeamA = 0;
            this.matches[matchNumber].scoreTeamB = 1;
            break;
        }
      },
      generateNewRound: function(){
        console.log(myMixin.data().id)
        fetch("http://localhost:8080/swiss/newSwissRound?" + new URLSearchParams({
          id:this.tournamentID
        }),{
          method: 'POST'
        })
            .then(function (response) {
              return response.json()
            })
            .then((data) => {
              console.log(data)
              for(var index in data){
                this.matches.push({
                  teamA: data[index].second.player1.name,
                  teamB: data[index].second.player2.name,
                  scoreTeamA: -1,
                  scoreTeamB: -1
                })
              }
            })
      }
    }
  }
})
</script>

<style scoped>
 .match{
   margin-left: 80px;
   margin-top: 20px;
   border: 4px solid #213555 ;
   padding: 20px 50px;
   border-radius: 60px;
   display: flex;
   width: 100%;
 }
 .inmatch{
   display: flex;
   position: relative;
   justify-content: center;
   flex:1;
 }
 .teams{
   border-radius: 20px;
   border: 2px solid #213555 ;
   padding: 20px 70px;
   font-size: 20px;
 }
 .buttons{
   color: #DDE6ED;
   border-radius: 20px;
   border: 3px solid #CC7469 ;
   padding: 10px 30px;
   background: #CC7469;
 }
 .buttons:hover{
   border: 3px solid #CC7469 ;
 }
 .center{
   top: 50%;
   margin: 0;
   -ms-transform: translateY(-50%);
   transform: translateY(-50%);
   position: relative;
 }
 /* Dropdown Button */
 .dropbtn {
   color: #DDE6ED;
   padding: 16px;
   font-size: 16px;
   cursor: pointer;
 }
 /* The container <div> - needed to position the dropdown content */
 .dropdown {
   position: relative;
   display: inline-block;
 }
 /* Dropdown Content (Hidden by Default) */
 .dropdown-content {
   display: none;
   position: absolute;
   background-color: #DDE6ED;
   min-width: 100px;
   box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
   z-index: 1;
 }
 /* Links inside the dropdown */
 .dropdown-content a {
   color: #213555;
   padding: 6px 16px;
   text-decoration: none;
   display: block;
 }
 /* Change color of dropdown links on hover */
 .dropdown-content a:hover {background-color: #c0c0c0;
 }
 /* Show the dropdown menu on hover */
 .dropdown:hover .dropdown-content {display: block;}
 .page{
   display: flex;
    justify-content: left;
 }
 .bigBUTTONCLASS{
   padding-left: 200px;
 }
 .bigBUTTONS{
   display: flex;
   flex-direction: row;
   justify-content: center;
   min-width: 50px;
 }
 .blue-button {
   display: flex;
   justify-content: center;
   background-color: #DDE6ED;
   color: #213555;
   border: none;
   border-radius: 0;
   margin: 0;
   cursor: pointer;
   transition: background-color 0.3s;
   margin-bottom: -2px;
   padding: 15px;
   font-size: 20px;
 }
 .blue-buttonH:hover {
   background-color: #bcc5cc;
 }
</style>
